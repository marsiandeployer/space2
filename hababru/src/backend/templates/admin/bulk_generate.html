{% extends "admin/base.html" %}

{% block title %}–ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è - Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üì¶ –ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è</h2>
    <div class="breadcrumb">
        <a href="/admin">–î–∞—à–±–æ—Ä–¥</a> ‚Ä∫ –ú–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
    </div>
</div>

<div class="card">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
    <form id="bulk-generate-form" method="post">
        <div class="form-group">
            <label for="product-select">–ü—Ä–æ–¥—É–∫—Ç:</label>
            <select id="product-select" name="product_id" required>
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç</option>
                <option value="contract_analysis">–ê–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤</option>
                <option value="news_analysis">–ê–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π</option>
            </select>
        </div>

        <div class="form-group">
            <label for="keywords-input">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É):</label>
            <textarea id="keywords-input" name="keywords" rows="6" placeholder="–¥–æ–≥–æ–≤–æ—Ä –∞—Ä–µ–Ω–¥—ã&#10;–¥–æ–≥–æ–≤–æ—Ä –ø–æ—Å—Ç–∞–≤–∫–∏&#10;—Ç—Ä—É–¥–æ–≤–æ–π –¥–æ–≥–æ–≤–æ—Ä&#10;–¥–æ–≥–æ–≤–æ—Ä —É—Å–ª—É–≥&#10;–¥–æ–≥–æ–≤–æ—Ä –ø–æ–¥—Ä—è–¥–∞" required></textarea>
        </div>

        <div class="form-group">
            <label for="template-select">–®–∞–±–ª–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</label>
            <select id="template-select" name="template">
                <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π</option>
                <option value="extended">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</option>
                <option value="minimal">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π</option>
            </select>
        </div>

        <div class="form-group">
            <label for="count-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:</label>
            <input type="number" id="count-input" name="count" min="1" max="50" value="5">
        </div>

        <div style="display: flex; gap: 1rem;">
            <button type="submit" class="btn btn-success">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é</button>
            <button type="button" class="btn btn-primary" onclick="previewGeneration()">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        </div>
    </form>
</div>

<div id="generation-status" class="card" style="display: none;">
    <h3>–°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
    <div id="progress-container">
        <div class="loading">
            <div class="spinner"></div>
            <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</p>
        </div>
        <div id="progress-details"></div>
    </div>
</div>

<div id="generation-results" class="card" style="display: none;">
    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
    <div id="results-content"></div>
</div>

<div class="card">
    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="text-align: center; padding: 1rem; background-color: var(--light-bg); border-radius: 5px;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--secondary-color);">22</div>
            <div style="font-size: 0.9rem; color: #666;">–í—Å–µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü</div>
        </div>
        <div style="text-align: center; padding: 1rem; background-color: var(--light-bg); border-radius: 5px;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--success-color);">5</div>
            <div style="font-size: 0.9rem; color: #666;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
        </div>
        <div style="text-align: center; padding: 1rem; background-color: var(--light-bg); border-radius: 5px;">
            <div style="font-size: 2rem; font-weight: bold; color: var(--warning-color);">15</div>
            <div style="font-size: 0.9rem; color: #666;">–í –æ—á–µ—Ä–µ–¥–∏</div>
        </div>
    </div>
</div>

<div class="card">
    <h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
    <ul>
        <li><strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –≤–∞—à–µ–π –Ω–∏—à–∏</li>
        <li><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–µ –±–æ–ª–µ–µ 10-15 —Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞ —Ä–∞–∑ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</li>
        <li><strong>–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
        <li><strong>–ü—Ä–æ–≤–µ—Ä–∫–∞:</strong> –í—Å–µ–≥–¥–∞ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π</li>
    </ul>
</div>

<script>
document.getElementById('bulk-generate-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const keywords = formData.get('keywords').split('\n').filter(k => k.trim());
    
    const data = {
        product_id: formData.get('product_id'),
        keywords: keywords,
        template: formData.get('template'),
        count: parseInt(formData.get('count'))
    };
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
    document.getElementById('generation-status').style.display = 'block';
    document.getElementById('generation-results').style.display = 'none';
    
    // –ò–º–∏—Ç–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ –±—É–¥–µ—Ç API –≤—ã–∑–æ–≤)
    simulateGeneration(data);
});

function simulateGeneration(data) {
    const progressDetails = document.getElementById('progress-details');
    
    setTimeout(() => {
        progressDetails.innerHTML = '<p>‚úÖ –ê–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω</p>';
    }, 1000);
    
    setTimeout(() => {
        progressDetails.innerHTML += '<p>‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>';
    }, 2500);
    
    setTimeout(() => {
        progressDetails.innerHTML += '<p>‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ SEO-—Å—Ç—Ä–∞–Ω–∏—Ü –∑–∞–≤–µ—Ä—à–µ–Ω–æ</p>';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        document.getElementById('generation-status').style.display = 'none';
        document.getElementById('generation-results').style.display = 'block';
        
        const resultsContent = document.getElementById('results-content');
        resultsContent.innerHTML = `
            <div class="alert alert-success">
                üéâ –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${data.keywords.length} —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ "${data.product_id}"
            </div>
            <h4>–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:</h4>
            <ul>
                ${data.keywords.map(keyword => `<li>üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è "${keyword}"</li>`).join('')}
            </ul>
            <div style="margin-top: 1rem;">
                <a href="/admin/seo-pages" class="btn btn-primary">üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</a>
            </div>
        `;
    }, 4000);
}

function previewGeneration() {
    const formData = new FormData(document.getElementById('bulk-generate-form'));
    const keywords = formData.get('keywords').split('\n').filter(k => k.trim());
    
    if (keywords.length === 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞');
        return;
    }
    
    const preview = `
–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ ${keywords.length} —Å—Ç—Ä–∞–Ω–∏—Ü:
${keywords.map((k, i) => `${i+1}. ${k}`).join('\n')}

–ü—Ä–æ–¥—É–∫—Ç: ${formData.get('product_id')}
–®–∞–±–ª–æ–Ω: ${formData.get('template')}
    `;
    
    alert(preview);
}
</script>
{% endblock %}
